#! /bin/sh
# These tests require a runnable memcached.

set -e
set -x

if pgrep memcached; then
	echo "ERROR: memcached is already running, abort."
	exit 255
fi

PIDFILE="$(mktemp -u)"
memcached -u nobody -d -P "$PIDFILE"

cleanup() {
	kill $(cat "$PIDFILE")
	rm -f "$PIDFILE"
}

trap cleanup EXIT

$@
